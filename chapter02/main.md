# 02. Predicting the Future: Variance and Sample Outcomes

- 分散とは、ある分布の結果の平均からの距離の二乗の加重和であり、平均からの分散を測る貴重な尺度である。
- 分散を期待値と比較するために、その平方根である標準偏差を使用する。
- 分散は試行間で加法的である。このため、次のような平方根の関係が生まれる。このため、複数の試行からなる標本の標準偏差と1つの試行の標準偏差との間に平方根の関係という関係が生じる。
- 中心極限定理は、標本の大きさが大きくなるにつれて、標本の分布の振る舞いが正規分布に近くなることが知られている。これによって 複雑な分布を正規分布で近似することができる。また，既知の分布から採取した複数試行の標本の振る舞いを理解することができる。

---

要素に値を持つ確率分布には、2つの特徴があり、それらを合わせると、試行を繰り返したときの分布の振る舞いのほとんどが説明できます。1つ目は、前章で説明した期待値です。もう1つは分散で、期待値からの結果のばらつきの尺度です。この2つの用語を大まかに特徴付けると、期待値は平均してどのくらい勝てるかを測り、分散は特定の結果が期待値からどのくらい離れているかを測れます。

分散を考えるとき、私たちは多くの試行から予想される結果の範囲を捉えようとしています。多くの分野で、結果の範囲は特に重要です。例えば、多くの製造環境では、平均値の両側には許容範囲と結果が存在します。この範囲の外側にある結果は好ましくありません。ポーカーでは、ほとんどのプレイヤーが期待値よりもはるかに多い勝率を得る結果に無頓着であるため、分散を一方的な現象として特徴付ける傾向があります。実際、「分散」はしばしば下振れの略語として使われます。

この見方は、特にプロのプレイヤーにとってはある程度実用的ですが、プラスの結果を無視する傾向が生まれ、その結果、これらのプラスの結果が実際よりも正しい分布であると思い込んでしまいます。統計学の重要な目的の一つは、一組の初期条件が与えられたときに、ある測定結果が得られる確率を求めることと、その逆、つまり測定結果から初期条件を推論することです。ポーカーでは、この2つが非常に重要な役割を担っています。ある初期条件から得られる結果の基本的な分布を**母集団**と呼び、観測された結果を**標本**と呼びます。ポーカーでは、母集団のすべての要素を測定することはできず、標本を観察することで満足しなければならないことがよくあります。

統計学の講義やテキストでは、確率やサンプリングの方法、仮説検定、相関係数など、さまざまなことを学びます。ポーカーを分析する際、私たちは確率の概念を多用し、時折他の統計手法も使用します。以下は、ポーカーを分析する際、特に観察された結果を分析する際に役立ついくつかの統計的概念について、簡単に説明したものです。これらのトピックについてより詳しい情報を得るには、統計学の教科書を参照することをお勧めします。

ポーカーでよく聞かれる質問に、「どれくらいの頻度で勝ちのセッションを期待すればいいのか」というものがあります。言い換えれば、この質問は、「あるゲームでの自分のセッションからなる集団から取られた特定のサンプルが、結果 > 0 を持つ確率はどのくらいか？」ということです。この質問に答える最も簡単な方法は、そのゲームでのセッションの確率分布を調べ、その確率を合計することです。

残念ながら、私たちはその分布を把握することができません。そのゲームのプレイについて過去にどれだけデータを集めても、あるのはサンプルだけなのです。しかし、仮にこのゲームにおけるあなたのハンドごとの期待値と分散がなんとなくわかっていて セッションの大きさがわかったとします。そうすると、統計的な手法で、あなたが勝つ確率を推定することができます。そして、統計的手法を使って、あなたが勝ち組になる確率を推定することができます。このうち、最初の項目である期待値（これは 分布の平均と呼ぶこともできます）は、第1章で説明しましたので、もうおなじみですね。

## 分散

分散は、分布の期待値からの結果の偏差を表す尺度です。コイントスでイーブンマネーを支払うベットと、サイコロで6の目を出したときに5勝ち、負けたら1失う勝負を考えてみましょう。これらの分布は両方ともEVが0ですが、サイコロはかなり高い分散を持っています。 $\dfrac16$ の確率で期待値から5の配当が得られ、 $\dfrac56$ の確率で期待値から1の配当を失います。分散を計算するには、まず期待値と結果の差を二乗し、それに発生する確率を掛けて、総和を求めます。

確率分布 $P$ に対して、 $n$ 個の結果のそれぞれが、値 $x_i$ と確率 $p_i$ , とすると、 $P$ の分散 $V_p$ は、

$V_p = \sum\limits_{i=1}^{n}p_i(x_i - < P >)^2$   **(2.1)**

各項は2乗されているため、分散は常に正であることに注意してください。  
コイントスの分散は、

$V_C = \dfrac12\cdot(1-0)^2 + \dfrac12(-1-0)^2$  
$V_C = 1$

サイコロの分散は、

$V_D = \dfrac56(-1-0)^2 + \dfrac16(5-0)^2$  
$V_D = 5$

ポーカーでは，ルース・アグレッシブなゲームは，タイト・パッシブゲームよりも分散が大きくります。これは，結果が平均値から離れるからです(勝つポットは大きくなりますが、負けるポットで失うお金は大きくなります)。プレイスタイルも分散に影響します。薄いバリューベットやセミブラフレイズなどは、分散を増加させる可能性のある高分散プレイの例です。期待値、またはその両方を高める可能性があります。一方、ルーズマニアックなプレイヤーは分散を大きくし、期待値を小さくするようなプレイをすることがあります。また、あまりにタイトなプレイは期待値と分散を共に減らすかもしれません。Part4では、バンクロールとリスクについて検討し、分散が効用に影響を与える枠組みを検討することにします。この部分以外では、この本では、ポーカーの意思決定の基準として分散を無視することにします。このように分散は、我々にとって、(期待値のような)規定統計量ではなく、記述統計量に過ぎません。

分散は、分布の平均からの予想される距離についての情報を与えてくれます。分散の最も重要な特性は、期待値と同じように、試行間で直接加法的であることです。つまり、先のサイコロのゲームを2回行った場合、2回の賭けを合わせた分散は2倍、つまり10になります。

期待値は事象ごとの期待値の単位で測定され、対照的に、分散は事象ごとの期待値の二乗の単位で計算されます。このため、分散と期待値を直接比較するのは簡単ではありません。もし、この2つの量を比較しようとするならば、標準偏差と呼ばれる分散の平方根をとります。サイコロの例では、1回の出目の標準偏差は $\sqrt{5}≒2.23$ となります。標準偏差を表すのに、ギリシャ文字の $\sigma$ (シグマ)を使うことが多く、先ほど利用した $V$ は分散を表すのによく使われます。

$\sigma= \sqrt{V}$ **(2.2)**  

$\sigma^2= V$ **(2.3)**

## 正規分布

ある分布から無作為に1つの結果を取り出すと、それは分布の可能な結果の1つである何らかの値を持っています。これを**確率変数**と呼びます。例えばコイントスをするとします。このとき、コイントスをすること自体が確率変数となります。2つの結果に「1」(表)と「0」(裏)のラベルを付けるとします。すると、コイントスの結果は、「1」( $\dfrac12$ の確率)か「0」( $\dfrac12$ の確率)のどちらかになります。もし コインを複数回ひっくり返して、それを合計すると、確率変数の結果の合計である値が得られます。これを**標本**と呼びます。標本の値は、標本の大きさに関わらず、コイントスの表の数になります。

例えば、100回のコイントスの結果を「1」、つまり表の総数として記録したとします。1回のコイントスの期待値は0.5なので、標本の期待値は50となります。

1回のコインの裏表の分散と標準偏差は、

$\sigma^2 = \dfrac12\cdot(1 - 1/2)^2 + \dfrac12(0 - 1/2)^2$  
$\sigma^2 = \dfrac14$  
$\sigma = \dfrac12$

前節から、コイントスの分散は加法性があることも分かっています。

ですから、100個のコイントスの分散は $100 \cdot \dfrac14 = 25$ です。

個々のコイントスに標準偏差があるように、標本にも標準偏差があります。しかし、分散とは異なり、標準偏差は加法性はありません。しかし、両者には以下のような関係があります。

$N$回の試行について、分散は次のようになります。

$\sigma^2_N = N\sigma^2$  
$\sigma_N = \sigma\sqrt{N}$

試行回数と標準偏差の平方根の関係は、複数回の試行で標準偏差がどのように変化するかを示す重要な結果です。コイントスを1回すると、標準偏差は $\dfrac12$ になります。これを100回行うと、100回の試行を含む標本の標準偏差は $50$ ではなく $\dfrac1{100}$ の平方根である $5$ になります。もちろん，100回ひっくり返したときの分散は $25$ なので，100回ひっくり返したときの標準偏差は，単純に平方根の $5$ であることがわかります。

標本の結果の分布は、それ自体が確率分布であり、**標本分布**と呼ばれます。統計学の重要な定理である**中心極限定理**は、標本分布と標準偏差の関係を記述しています。中心極限定理とは、標本のサイズが大きくなるにつれて、標本の値を集計した分布が**正規分布**と呼ばれる特殊な分布に収束することです。

>cf. [中心極限定理](https://bellcurve.jp/statistics/course/8543.html)

正規分布は、母集団の平均値を頂点とするベル型の曲線で、 $x$ 値が負または正の無限大になると尾部は漸近的に $0$ に近づきます。また、曲線は母集団の標準偏差でスケーリングされます。正規分布の曲線下の面積は(すべての確率分布と同様に) $1$ に等しく、区間 $[x_1，x_2]$ の曲線下の面積は、特定の結果が $x_1$ と $x_2$ の間に入る確率に等しくなります。この領域は、図2.1では領域Aで記されています。

![std-normal-dist](/resources/img/chapter02/main/02-01.png)

中心極限定理とは、ある母集団があり、十分な数のサンプル（どの程度の大きさかはデータの種類によります）を取れば、サンプルの結果は母集団の平均を中心としたベル型のカーブを描き、その分散は基礎母集団の分散に関係する、というものです。

平均と標準偏差を持つ分布の正規分布関数の方程式は、次のとおりです。  
$N(x. \mu, \sigma)=\dfrac{1}{\sigma\sqrt{2\pi}}exp(\dfrac{(x - \mu)^2}{2\sigma^2})$ **(2.5)**

正規分布曲線の下の2点間の面積を求めると、対応する平均と分散を持つ標本の値が、その2点間に入る確率がわかります。正規分布は平均に対して対称なので、全体の面積の $\dfrac12$ は平均の右側にあり、 $\dfrac12$ は左側にあります。正規曲線の下での面積を計算する通常の方法は，各点について**z-score**と呼ばれるものを作成します。このz-scoreは，結果 $x$ が平均から何倍離れているかという標準偏差の数を表しています。

$z = \dfrac{x - \mu}{\sigma}$ **(2.6)**

そして、 $z$ の累積正規分布と呼ばれるものを求めることができます。平均を $0$ 、標準偏差を $1$ としたときの曲線の下での、 $z$ の左側の領域です。この関数を $Ф(z)$ とします。(図2.2)

zを正規化したz-score値とすると、zの累積正規分布関数は次のようになります。

$\Phi(z) = \dfrac{1}{\sqrt{2\pi}}\int_{-\infty}^{z}exp(-\dfrac{x^2}{2})$ **(2.7)**

![cumulative-normal-distribution](/resources/img/chapter02/main/02-02.png)

2つの値 $x_1$ と $x_2$ の間の面積を求めるには、 $x_1$ と $x_2$ のz-score $z_1$ と $z_2$ を計算し、累積正規分布値 $\Phi(z_1)$ と $\Phi(z_2)$ を求め、それを引くことで求められます。 $\Phi(z)$ をz-scoreの累積正規分布関数とすると、平均 $μ$ 、標準偏差 $\sigma$ の正規分布関数から取ったサンプルが、2つのz-score $x_1$ , $x_2$ の間に入る確率は、

$p = \Phi(\dfrac{x_1 - \mu}{\sigma}) - \Phi(\dfrac{x_2 - \mu}{\sigma})$ (2.8)

$\Phi(z)$ の値の表と、表計算ソフトによりこれらの値を導き出すことができます。いくつかの重要な値は、統計学を学ぶ学生にはよく知られています。 $z = -1$ と $z = +1$ の間の面積は約 $0.68$ 、 $z = -2$ と $z = +2$ の間の面積は約 $0.955$ 、 $z = -3$ と $z = +3$ の間の面積は約 $0.997$ です。  
cf. [正規分布表](https://bellcurve.jp/statistics/course/7805.html)  
cf. [Note/How to read a normal distribution table](note.md#how-to-read-a-normal-distribution-table)

これらの値は、正規分布からの標本の値が下がることを意味します。  
平均値の $(\mu - \sigma)$ と $(\mu + \sigma)$ の間にある確率は、68%。  
平均値の $(\mu - 2\sigma)$ と $(\mu + 2\sigma)$ の間にある確率は、95.5％。
平均値の $(\mu - 3\sigma)$ と $(\mu +3\sigma)$ の間にある確率は、99.7％。

このことを明確にするために、以下の例を考えてみましょう。先ほどのサイコロゲームのパラメータを変更してみます。サイコロを投げ、1-5の目で1点を失い、６の目で6点を獲得します。この新しいゲームを $D_2$ と呼ぶことにします。

このゲームの期待値は,  
$\langle D_2 \rangle = \dfrac56 \cdot (-1) + \dfrac16 \cdot 6$  
$\langle D_2 \rangle = \dfrac16$ (units/trial)

プレイヤーが勝つと、6点を獲得します。この結果から平均値である $\dfrac16$ を引くと、次のようになります。

$V_{win} = (6 - \dfrac16)^2$  
$V_{win} = (\dfrac{35}6)^2$

同様に、負けたときは1点を失います。ここから平均値である $\dfrac16$ を引くと、次のようになります。

$V_{lose} = (-1 - \dfrac16)^2$  
$V_{lose} = (- \dfrac76)^2$

ゲームの分散は

$V_{D2} = p(win)(V_{win})＋p(lose)(V_{lose})$  
$V_{D2} = \dfrac16 \cdot (\dfrac{35}6)^2 + \dfrac56 \cdot (-\dfrac76)^2$  
$V_{D2} \simeq 6.806$ (units^2^/trial^2^)

サイコロを200回投げるとします。200回投げて、総合的に勝つ確率はどのくらいでしょうか？40単位以上獲得できる確率はいくらでしょうか？100単位以上獲得できる確率はいくらでしょうか？

この問題は，先ほどまとめた方法で解くことができます。まず、標準偏差を計算します。まず、200回の試行の標準偏差(標準誤差)を計算します。これは、次のようになります。

$\sigma = \sqrt{V} = \sqrt{6.806}=2.61$ (units/trial)

2.4を適用すると、次のようになります。

$\sigma_N = \sigma \sqrt{N}$  
$\sigma_{200}= 2.61\sqrt{200} = 36.89$ (units/200trials)

200回の試行では、この分布の期待値、つまり平均値 $\mu$ は $\dfrac16$ (units/200trials) であり、 $33.33$ unitsです。(2.6)を用いると、点 $0$ のz-scoreは次のように求められます。

$z_x = \dfrac{x - \mu}\sigma$ ここで $x = 0$  
$z_0 = \dfrac{0-33.33}{36.89}$  
$z_0 = -\dfrac{33.33}{36.89}$  
$z_0 = -0.9035$

統計学の教科書に載っている確率表を参照すると、ある結果が左側に来る確率は、このz-scoreの左に位置する確率 $\Phi(-0.9035)$ である $0.1831$ です。 $18.31$ %の確率で200回試行した時点で獲得できる点数は $0$ 以下になります。 $40$ 単位を獲得する確率を求めるには、そのポイントのz-scoreを求めます。

$z_{40} = \dfrac{40-33.33}{36.89} = 0.1807$  
$\Phi(0.1807) = 0.5717$

しかし、 $\Phi(0.1807)$ は、観測された結果が40単位より左にある確率、つまり、少なくとも40単位以下となる確率です。この値より右側にある確率、つまり40単位以上の確率を求めるには、実際には $1 - \Phi(0.1807)$ を求める必要があります。

$1 - \Phi(0.1807) = 1 - 0.5717 = 0.4283$

つまり、200回投げて少なくとも $40$ 単位を獲得する確率は $42.83$ %です。

また、100個獲得する場合も同様に、

$z_{100} = \dfrac{100-33.33}{36.89} = 1.8070$

確率表から、 $\Phi(1.8070) = 0.9646$ であることがわかります。よって、

$p = 1 - \Phi(1.8070)$  
$p = 0.0354$

200回投げて $100$ 単位獲得する確率は $3.54$ %です。

ただし、これらの値はあくまで近似値であり、200回振った場合の標本の分布は完全な正規分布ではありません。そこで、コンピュータを使って、この値を直接計算することができます。

||直接計算|近似値|
|:--|:--:|:--:|
|200回試行して0点以上勝つ確率|81.96%|81.69%|
|200回試行して40点以上勝つ確率|40.46%|42.83%|
|200回試行して100点以上勝つ確率|4.44%|3.54%|

ご覧のように、これらの値にはわずかな違いがあります。この原因の多くは、直接計算が離散的な値しか持たないためです。このゲームを200回試行すると、 $+38$ と $+45$ の結果が得られますが、 $+39$ と $+42$ の結果は得られません。というのも，勝利から得られる結果は $+6$ だけだからです。正規近似は、すべての値が可能であると仮定しています。

この方法を用いて、冒頭の「どれくらいの頻度で勝ちのセッションを期待すればいいのか」という問題に戻ります。この問題を解くには、ハンドごとの期待値、ハンドごとの分散、そしてセッションの大きさを知る必要があります。あるゲームの勝率が１ハンドあたり約0.015ベットで、同じ間隔の標準偏差が１ハンドあたり2ベットであるプレイヤーを考えてみましょう。このプレイヤーが300ハンドのセッションをする予定だとします。(ライブポーカーでは約9時間、オンラインでは2〜3時間のセッションになります)。このプレイヤーは1回のセッションでどれくらいの頻度で勝つ(結果が0より大きくなる)ことを期待するべきでしょうか?

まず、標本の期待値 $\mu_N$ を計算します。

$\mu_N = N\mu$  
$\mu_N = 300 \cdot 0.015$  
$\mu_N = 4.5$

次に、300ハンドのセッションにおける標準偏差を計算します。

$σ_N = \sigma\sqrt{N}$  
$σ_{300} = 2 \cdot \sqrt{300}$  
$σ_{300} = 34.6$

次に、この値に対する z-scoreと $\Phi(z)$ を求めます。

$z_x = \dfrac{x - \mu N}{\sigma}$  
$z_0 = \dfrac{0 - 4.5}{34.6}$  
$z_0 = -0.1299$

正規分布表から、次のようになります。

$\Phi(-0.1299) = 44.83$%  
$p = 1 - \Phi(-0.1299)$  
$p = 1- 0.4483$  
$p = 0.55171$

これは、44.83%の確率で $0$ 以下、つまり55.17%の確率で勝ちのセッションがあることを表しています。実際には、心理的な理由から、より多くの勝ち組になるためにプレイ習慣を変えることもあるでしょうし、ゲーム状況やその他の理由で「勝率」は大きく変動しているのが現実です。しかし、単純に300ハンドをプレイするプレイヤーは、55%強の確率で $0$ を超えると予想されます。

もっと極端な例もあります。あるプレイヤーが著者の一人に、数ヶ月間にオンラインで見たAQ対AKのAll In Preflopの対決をすべてマークしたスプレッドシートを保管しており、2000回の対戦の後、両者はほぼ50対50で決着がついたと言ったことがあります。

サイトのカードが公正で、フォールドされたハンドに基づく追加情報がないと仮定すると、これはどの程度の確率なのでしょうか？

まず、1回の対決の分散または標準偏差を考えてみましょう。

AK対AQはプリフロップで約73.5%でAKが勝利します(全てのスートの組み合わせを含みます)。ここでAKの勝ちに1を、AQの勝ちに0を割り当ててみましょう。そうすると、平均は0.735となります。一回の対決の分散を計算すると、

$V = 0.735 \cdot (1 - 0.735)^2 + 0.265 \cdot (0 - 0.735)^2$  
$V = 0.1948$  
$σ = 0.4413$

2,000ハンドの平均は、

$\mu_N = N\mu$  
$\mu_N = 2000 \cdot 0.735$  
$\mu_N = 1470$

2,000ハンドの標本について、(2.4)を用いると、標準偏差は次のようになります。

$\sigma_N = \sigma\sqrt{N}$  
$\sigma_{2000} = 0.4413 \cdot \sqrt{2000}$  
$\sigma_{2000} = 19.737$

ここで結果は、2000ハンドの50％、つまり1000ハンドであり、標本平均は2000ハンドのうち約1470ハンドとなります。z-scoreは(2.6)を用いて求めることができます。

$z_x = \dfrac{x - \mu N}{\sigma}$  
$z_{1000} = \dfrac{1000-1470}{19.737}$  
$z_{1000} = -23.815$

この場合、結果は2000ハンド中1000ハンドであり、期待される母平均は2000ハンド中1470ハンドです。この結果は、平均値から約23.815標準偏差離れていることになります。実際、表計算ソフトでは、 $\Phi(-23.815)$ はちょうどゼロに等しい結果が出ます。これは驚異的に低い確率であると言えば十分でしょう。

可能性が高いのは、このプレイヤーが誇張しているか、真っ赤な嘘をついているか、あるいはAKがAQに勝ったときに、それが「予想された」結果であるために気づくのを忘れるというよくあるミスを犯したかのどちらかであるということです。これは、「認知バイアス」と呼ばれる心理的効果に関連しています。あるいはネットのサイトが「不正」だったのかもしれません。この例がメーリングリストに投稿されたとき、一部の参加者の反応は、ポーカーの高い分散性を指摘し、2000ハンドで幅広い結果があり得ると主張するものでした。しかし、これは2000個のポーカーハンドの勝敗(分散はかなり大きい)という全く別の問題と、1個のポーカーハンドの結果(分散はかなり大きい)を混同しています。ほとんどのポーカーで、大きな賭けをする単一ハンドの分散は、PreflopのAll In対決の勝者の分散よりもはるかに大きいです。この例から得られる教訓は、この例からわかることは、ポーカーのハンドの結果の高い分散と、他の種類の分布の比較的低い分散を混同してはいけないということです。

ポーカーをプレイしているとき、多くのランダムな出来事が起こります。私たちやテーブルにいる他のプレイヤーには、すべての2枚のカードの組み合わせを含む分布から選ばれたランダムなカードが配られます。ベットも行われ、カードを交換したり、追加のカードを配ってハンドの価値を変えたりする機会もあります。それぞれのハンドは、大きなポットを獲得したり、ブラインドを奪ったり、ベットで負けたり、大きなポットを失ったりと、私たちに何らかの結果をもたらします。この結果は、ハンドの中で起こる小さなランダムな出来事や、それほどランダムではない出来事、例えば対戦相手のことを教えてもらって、そうしなければ勝てなかったポットを勝てるようになったり、負けたときにベットを節約できるようになったりします。それでも、中心極限定理の威力は、個々のハンドの結果が、あたかも「ハンドの結果」分布から選ばれた確率変数であるかのように機能することです。同様に、セッション、週、月、そして私たちのポーカーキャリア全体の結果は、あたかもこの分布から適切なサイズの標本を取ったかのように振る舞います。

試行回数と標準偏差の平方根の関係は、これを特に有用なものにしています。試行回数が増えれば増えるほど、結果が期待値から相対的に大きく離れる確率が減るからです。

あるリミットでのハンド結果の分布が，100ハンドあたり平均値が\$75，分散は1ハンドあたり\$6,400であるとします．このプレイヤーの分布から異なる数のハンドをサンプリングすると、標本の大きさが結果の分散にどのような影響を与えるか見ることができます。ある標本に対して、このプレイヤーの結果が、 $\mu - 2\sigma$ と $\mu + 2\sigma$ の間にある確率は95.5%です。続いて各サンプルサイズについて確認します。

- 平均値 $\mu_N$
- 標準偏差 $\sigma$
- 95.5%確率区間の2つの端点

![table01](/resources/img/chapter02/main/02-03.png)

ご覧のように、少ないハンド数の場合、結果は負けと勝ちで大きく異なります。しかし、標本のサイズが大きくなるにつれて、標本の結果の相対的な近さが大きくなっていきます。1,000,000ハンドの標準偏差と、100ハンドの標準偏差を比較すると、標準偏差の大きさは100倍ですが、ハンド数との比較では100倍以上より小さくなります。これは、**大数の法則**が働いているのです。標本が大きければ大きいほど、標本の結果は相対的に近くなります。
